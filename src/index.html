<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>AmigaPal</title>

    <link href="../bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../bower_components/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../bower_components/angularjs-slider/dist/rzslider.css">
    <link rel="stylesheet" href="../bower_components/angular-bootstrap/ui-bootstrap-csp.css"></script>
    <!--<link href="css/style.css" rel="stylesheet">-->
    <style type="text/css">
      @font-face {
        font-family: protracker;
        src: url('../fonts/protracker.ttf');
      }

      html {
        height: 100%;
      }

      body {
        padding: 20px;
        /*background-color: #f5f5f4;*/
        background-color: #292c34;
        color: #a2a7b6;
        font-family: system,-apple-system,".SFNSDisplay-Regular","Helvetica Neue",Helvetica,"Segoe UI",sans-serif !important;
        font-size: 13px;
        height: 100%;
        width: 100%;
      }
      #logotext {
        font-family: protracker;
        font-size: 34px;
        text-align: center;
        padding-bottom: 20px;
        padding-top: 0px;
        text-shadow: -2px 2px #fff;
        margin-top: -20px;
      }
      input[type="text"], input[type="number"], select, button, input[type="radio"], input[type="checkbox"], textarea {
      outline: none;
      box-shadow:none !important;
      }

      input[type="text"], input[type="number"], select, input[type="radio"], input[type="checkbox"], textarea {
      border:1px solid #ccc !important;
      }

      .mainwrap {
        margin: 0 auto;
      }

      .dropzone {
        width: 100%;
        height: 510px;
        border: dashed 8px #999;
        border-radius: 30px;
        display: table;
      }
      .dropzone .droptext {
        display: table-cell;
        text-align: center;
        vertical-align: middle;
      }

      .filelist {
        width: 100%;
        margin: 0 auto;
      }

      .btn-toolbar {
        padding-bottom: 8px;
      }

      .global-options {

      }

      .fileitem {
        padding-top: 6px;
        padding-bottom: 6px;
        min-width: 100%
      }

      .fileitem:nth-child(odd){
        /*background-color: #e8e8e8;*/
        background-color: #393c44;
      }

      .custom-slider.rzslider .rz-bar {
        background: #999;
        height: 2px;
      }
      .custom-slider.rzslider .rz-selection {
        background: #fff;
      }

      .custom-slider.rzslider .rz-pointer {
        width: 8px;
        height: 16px;
        top: auto; /* to remove the default positioning */
        bottom: 0;
        background-color: orange;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
      }

      .custom-slider.rzslider .rz-bubble {
        color: #fff;
      }


      .custom-slider2.rzslider .rz-pointer.rz-pointer-min {
        background-color: #fff;
      }

      .custom-slider.rzslider .rz-pointer:focus {
        outline: none;
      }

      .custom-slider.rzslider .rz-pointer:after {
        display: none;
      }

      .custom-slider.rzslider .rz-bubble {
        bottom: 14px;
      }

      .custom-slider.rzslider .rz-limit {
        font-weight: bold;
        color: #555;
      }

      .custom-slider.rzslider .rz-tick {
        width: 1px;
        height: 10px;
        margin-left: 4px;
        border-radius: 0;
        background: #999;
        top: -1px;
      }

      .custom-slider.rzslider .rz-tick.rz-selected {
        background: #555;
      }


      .custom-slider2.rzslider {
        margin-top: 14px;
      }
      .custom-slider2.rzslider .rz-bar {
        background: #999;
        height: 2px;
      }
      .custom-slider2.rzslider .rz-selection {
        background: #555;
      }

      .custom-slider2.rzslider .rz-pointer {
        width: 11px;
        height: 11px;
        top: -5px; /* to remove the default positioning */

        background-color: #333;
/*
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;*/

      }

      .custom-slider2.rzslider .rz-pointer:focus {
        outline: none;
      }

      .custom-slider2.rzslider .rz-pointer:after {
        display: none;
      }

      .custom-slider2.rzslider .rz-bubble {
        bottom: 14px;
      }

      .custom-slider2.rzslider .rz-limit {
        font-weight: bold;
        color: #555;
      }

      .custom-slider2.rzslider .rz-limit, .custom-slider2.rzslider .rz-floor {
        display: none;
      }

      .custom-slider2.rzslider .rz-bubble {
        display: none;
      }

      .custom-slider2.rzslider .rz-tick {
        width: 1px;
        height: 10px;
        margin-left: 4px;
        border-radius: 0;
        background: #999;
        top: -1px;
      }

      .custom-slider2.rzslider .rz-tick.rz-selected {
        background: #555;
      }

    </style>
  </head>
  <body ng-app="mainApp" ng-controller="MainCtrl">
    <div class="mainwrap" style="max-width: 600px">
      <!-- rubbishy oul' guff
        <button type="button" class="btn btn-sm btn-primary pull-right" data-toggle="collapse" data-target="#guide">?</button>
      -->

      <!--
      <div class="row" id="logotext">
        <div class="col-sm-12">
          AmigaPal
        </div>
      </div>
      -->

      <div class="row collapse" id="guide">
        <div class="col-sm-12">



          <p>
            <h4>README</h4>
            <ul>
              <li>
                "Why is it called AmigaPal?" - I made this for myself, to speed up converting audio samples into the format
                I generally use in ProTracker on the Amiga. They need to be mono, 8bit, and it's useful if they conform to the samplerates ProTracker uses for musical notes.
                By default AmigaPal converts to 27928hz (A-3), which produces a relatively high quality 8bit 8svx file. So it's a helper tool (hence pal), plus I grew up
                using PAL-region Amigas (hence pal), plus I like the redundancy of Amiga (friend) and Pal (friend). Also it currently defaults to using PAL samplerates for
                ProTracker notes...I may add in NTSC as an alternative if there's any demand. AmigaPal is essentially a front-end for a SoX command that I baked with the help
                of h0ffman, kebby and some of my own trial-and-error testing. The dream would be to replicate the lowpass filter 8bitbubsy has implemented in his MacOS/PC port
                of ProTracker and use it as post-bit reduction processing to reduce some dithering noise, but I haven't been able to match it so far. Right now, AmigaPal gives the
                best quality I've been able to achieve within ProTracker's limitations, according to my tastes - YMMV!
              </li>
              <li>
                "Why won't it work?" - no idea, but the most likely thing is that you've not installed SoX, or that SoX isn't available in your default shell path.
                Test this by opening a terminal or command prompt and typing 'sox'. I might try bundling the SoX executable into the app in future.
              </li>
              <li>
                Drop audio files or folder onto the app to load them into the preview list
              </li>
              <li>
                Target duration is affected by the semitone transpose, as this (deliberately) lengthens or shortens the sample.
              </li>
              <li>
                Target filesize is an estimate, but should be pretty close for most samples. 128kb is the largest sample the MOD format supports,
                and most trackers and modern replayers won't have a problem with that. Remember, though, that the most popular Amiga ASM replayer code believes 64kb to be the maximum, so will freak out.
              </li>
              <li>
                L + R mixes both stereo channels to one; L or R use either. If your input file has more than 2 channels, L + R should still mix to mono.
              </li>
              <li>
                The waveform view is a good guideline, but not precisely accurate: use your EARS to make sure a trim range is correct, as what you hear is what will be rendered.
              </li>
              <li>
                The defaults are recommended for converting most types of audio file for use in Protracker.
              </li>
              <li>
                Global options are saved automatically for next time.
              </li>
              <li>
                The extension filter is used when scanning a folder of files to load - leave it blank to load all filetypes.
              </li>
              <li>
                Batch Convert does what you think it does. Be sure that's what you want before clicking it with a huge folder of samples loaded.
              </li>
              <li>
                If you've loaded a bunch of files but want different output settings for them, no problem: convert them individually, changing the global options between each conversion. The current options are always the ones used at the time you click Convert.
              </li>
            </ul>
            <br>
          </p>
          <br>
          <p>
            <h4>TO DO: </h4>
            <ul>
              <li>
                Test Windows
              </li>
              <li>
                Bundle sox binary, get exec to call a built-in path?
              </li>
              <li>
                Configurable (and ignorable) output folder. Currently, all converted files are placed in the same directory as the source file.
              </li>
            </ul>
          </p>
          <br><br>
        </div>
      </div>


      <div class="row global-options">

        <div class="col-12">

        </div>






         <div class="col-6">

           <div class="form-group row">
             <label class="col-5 col-form-label">ProTracker Note</label>
             <div class="col-7  input-group input-group-sm">
               <select class="input-group-addon custom-select" ng-model="options.samplerate" style="min-width: 100%" ng-options="value as key for (key, value) in ptnotes">
               </select>
             </div>
           </div>

           <div class="form-group row">
             <label class="col-5 col-form-label">Samplerate</label>
             <div class="col-7 input-group input-group-sm" >
               <input class="form-control" type="number" value="0" min="0" step="1" ng-model="options.samplerate">
               <div class="input-group-addon">Hz</div>
             </div>
           </div>

            <div class="form-group row">
              <label class="col-5 col-form-label">Mixdown</label>
              <div class="col-7  input-group input-group-sm">
                <select class="input-group-addon custom-select" ng-model="options.mixdown" ng-disabled="!options.mono_enabled" style="min-width: 100%">
                  <option value="'-'">L + R</option>
                  <option value="'1'">Left</option>
                  <option value="'2'">Right</option>
                </select>
              </div>
              <!-- don't know why this exists
              <label class="col-7 offset-md-5 col-form-label">
                Disable with 'Mono'
              </label>-->
            </div>

            <div class="form-group row">
              <label class="col-5 col-form-label">8khz Lowpass</label>
              <div class="col-7">
                <div class="form-check">
                  <label class="form-check-label" style="margin-top: 6px;">
                    <input class="form-check-input" type="checkbox"ng-model="options.mono_enabled">
                  </label>
                </div>
              </div>
            </div>

            <!-- This doesn't work. Did it ever work? Am I going mad?
            <div class="form-group row">
              <label class="col-5 col-form-label">Transpose</label>
              <div class="col-7 input-group input-group-sm">
                <input class="form-control" type="number" value="0" step="1" ng-model="options.transpose">
              </div>
              <label class="col-7 offset-md-5 col-form-label">
                100 = 1 semitone
              </label>
            </div>
          -->



        </div>

        <div class="col-6">

            <!-- let's get rid of this - drag and drop only?
            <div class="form-group row">
              <label class="col-3 col-form-label">Folder</label>
              <div class="col-9  input-group input-group-sm">
                <span class="input-group-btn">
                  <button type="button" class="btn btn-sm btn-default" ng-click="chooseDir();"><i class="fa fa-folder-open"></i></button>
                  <input id="selected_dir" class="form-control" name="selecteddir" type="file" webkitdirectory style="display:none" />
                </span>
                <input type="text" class="form-control" placeholder="Path..."  ng-model="options.defaultdir">
              </div>
            </div>
          -->

            <div class="form-group row">
              <label class="col-3 col-form-label">Filter</label>
              <div class="col-9  input-group input-group-sm">
                <input class="form-control" type="text" placeholder=".wav" ng-model="options.filterext">
              </div>
              <label class="col-9 offset-sm-3 col-form-label">
                <span ng-if="options.filterext.length > 0">Only load <strong>{{options.filterext}}</strong> files</span>
                <span ng-if="options.filterext === '*' || options.filterext.length < 1">Load all files</span>
              </label>
            </div>

            <!-- abolished
            <div class="form-group row">
              <label class="col-3 col-form-label">Append</label>
              <div class="col-9  input-group input-group-sm" style="width: 100%;">

                <input class="form-control" type="text" placeholder="_ami" ng-model="options.fname_append" style="max-width: 50%; max-height: 30px;">
                <select class="input-group-addon custom-select" ng-model="options.append_pos" style="height: 30px; padding-top: 8px; width: 50%;">
                  <option value="prefix">prefix</option>
                  <option value="suffix">suffix</option>
                </select>

              </div>
              <label class="col-9 offset-md-3 col-form-label">Preview:
                <span ng-if="options.append_pos.indexOf('prefix') > -1"><i>{{options.fname_append}}filename.wav</i></span>
                <span ng-if="options.append_pos.indexOf('suffix') > -1"><i>filename{{options.fname_append}}.wav</i></span>
                </label>

            </div>
          -->


            <div class="form-group row">
              <label class="col-3 col-form-label">Playback Volume</label>

              <div class="col-9">
                <rzslider  class="custom-slider2" rz-slider-options="{ floor: 0, ceil: 100 }" rz-slider-model="options.playbackvolume"></rzslider>
              </div>
          </div>

          <div class="form-group row">
            <div class="col-12 text-right">
              <div class="btn-group ">
                  <button type="button" class="btn btn-sm btn-secondary" ng-click="files = [];">
                    <i class="fa fa-trash-o"></i> Clear All
                </button>
              </div>
              &nbsp;
              <div class="btn-group ">
                  <button type="button" class="btn btn-sm btn-secondary" ng-click="convertAll();">
                    <i class="fa fa-exchange"></i> Convert All
                </button>
              </div>
              <br><br>
            </div>
          </div>

        </div>


        <!-- These are just on by default now
        <div class="col-4">

            <div class="form-group row">


              <div class="col-3">
                <div class="form-check">
                  <label class="form-check-label" style="margin-top: 6px;">
                    <input class="form-check-input" type="checkbox"ng-model="options.normalise">
                  </label>
                </div>
              </div>
              <label class="col-9 col-form-label">Normalise</label>


              <div class="col-3">
                <div class="form-check">
                  <label class="form-check-label" style="margin-top: 6px;">
                    <input class="form-check-input" type="checkbox"ng-model="options.dither">
                  </label>
                </div>
              </div>
              <label class="col-9 col-form-label">Dither</label>

              <div class="col-3">
                <div class="form-check">
                  <label class="form-check-label" style="margin-top: 6px;">
                    <input class="form-check-input" type="checkbox"ng-model="options.mono_enabled">
                  </label>
                </div>
              </div>
              <label class="col-9 col-form-label">Mono</label>





            </div>




         </div>
         -->


      </div>


      <div class="row">

      </div>


      <div class="dropzone" ng-if="files.length <= 0">
        <div class="droptext">
          Drop files or folders here
        </div>
      </div>

      <div ng-if="files.length > 0">
        <div class="row fileitem" ng-repeat="file in files" on-finish-render="postRender()">
          <div class="col-3">
            <!--<audio id="audio-{{$index}}">
              <source ng-src="{{file.fullpath}}" type="audio/wav" />
            </audio>-->
            Target filename: <br><i><span ng-bind="file.targetfilename"></span></i><br>
            Target filesize: <span ng-bind="file.outputsize | number: 0"></span> bytes <br>
            <!--Target duration: <span ng-bind="file.outputduration | number: 2"></span> seconds      <br>-->
            Target duration: <span ng-bind="file.trimrange | number: 2"></span>
          </div>
          <div class="col-6" style="padding: 0 !important">

            <div style="width: 325px; height: 60px;">
              <rzslider style="width: 325px;" class="custom-slider" rz-slider-model="file.trimstart" rz-slider-high="file.trimend" rz-slider-options="file.trimoptions"></rzslider>
              <canvas style="position: absolute; width: 325px; height: 60px; top: 7px; left: 0;" id="wform-canvas-{{$index}}">
              </canvas>
              <div id="playhead-{{$index}}" style="left: 0; position: absolute; z-index: 3000; background-color: #ff8800; width: 1px; height: 85px; margin-top: -58px">
              </div>
            </div>



          </div>

          <div class="col-3 offset-md-9 text-right">
            <br>
            <div class="align-middle" style="display: block">
              <div style="padding-bottom: 4px;">
                <button type="button" class="btn btn-sm btn-secondary"  ng-click="playerControl($index);">
                  <i class="fa" ng-class="{'fa-play': file.player.paused == true, 'fa-pause': file.player.paused != true}"></i>
                </button>
                <button type="button" class="btn btn-sm btn-secondary"  ng-click="removeFile($index);">
                  <i class="fa fa-trash-o"></i> Remove
                </button>
              </div>
              <button class="btn btn-secondary btn-sm" ng-disabled="file.processing" ng-click="processItem($index, null)"><i class="fa fa-exchange"></i> {{file.buttontext}}</button>
            </div>
          </div>

        </div>
      </div>


    </div><!--mainwrap end-->



  </body>

  <!-- Insert this line above script imports  -->
  <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>

  <!-- normal script imports etc  -->
  <script
    src="https://code.jquery.com/jquery-1.12.4.min.js"
    integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
    crossorigin="anonymous">
  </script>

    <script src="../bower_components/angular/angular.min.js"></script>
  <script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="../bower_components/angular-animate/angular-animate.min.js"></script>
  <script src="../bower_components/angular-touch/angular-touch.min.js"></script>
  <script src="../bower_components/angular-bootstrap/ui-bootstrap.min.js"></script>


  <script src="../bower_components/angularjs-slider/dist/rzslider.min.js"></script>
	<script src="../bower_components/electangular/electangular.js"></script>

  <!-- Insert this line after script imports -->
  <script>if (window.module) module = window.module;</script>

  <script>
      // You can also require other files to run in this process
      require('./renderer.js')
    </script>

</html>
